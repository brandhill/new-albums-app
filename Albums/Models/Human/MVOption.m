#import "MVOption.h"

///////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////
@interface MVOption ()

@end

///////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////
@implementation MVOption

///////////////////////////////////////////////////////////////////////////////////////////////////
+ (MVOption *)optionWithKey:(NSString *)key inMoc:(NSManagedObjectContext *)moc
{
  NSPredicate *predicate = [NSPredicate predicateWithFormat:@"key == %@", key];
  NSString *entityName = [self entityName];
  NSFetchRequest *request = [NSFetchRequest fetchRequestWithEntityName:entityName];
  [request setPredicate:predicate];
  
  NSArray *requestResults = nil;
  NSError *error;
  requestResults = [moc executeFetchRequest:request error:&error];
  
  int nbRequests = (int)[requestResults count];
  if (nbRequests == 0)
  {
    MVOption *option = [MVOption insertInManagedObjectContext:moc];
    option.key = key;
    return option;
  }
  return [requestResults objectAtIndex:0];
}

@end
